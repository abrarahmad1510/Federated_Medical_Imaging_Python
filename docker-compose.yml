version: '3.8'
services:
# PostgreSQL Database
postgres:
image: postgres:15-alpine
container_name: medical-fl-postgres
environment:
POSTGRES_DB: ${DB_NAME:-medical_fl}
POSTGRES_USER: ${DB_USER:-fl_admin}
POSTGRES_PASSWORD: ${DB_PASSWORD}
PGDATA: /var/lib/postgresql/data/pgdata
volumes:
- postgres_data:/var/lib/postgresql/data
- ./deploy/docker/postgres-init.sql:/docker-entrypoint-initdb.d/init.sql
networks:
- medical-fl-network
healthcheck:
test: ["CMD-SHELL", "pg_isready -U ${DB_USER:-fl_admin}"]
interval: 10s
timeout: 5s
retries: 5
restart: unless-stopped
# Redis for caching and queues
redis:
image: redis:7-alpine
container_name: medical-fl-redis
command: redis-server --requirepass ${REDIS_PASSWORD:-redis_password_123}
volumes:
- redis_data:/data
networks:
- medical-fl-network
healthcheck:
test: ["CMD", "redis-cli", "ping"]
interval: 10s
timeout: 5s
retries: 5
restart: unless-stopped
# Backend API
backend:
build:
context: .
dockerfile: deploy/docker/backend.Dockerfile
container_name: medical-fl-backend
environment:
FLASK_ENV: ${APP_ENV:-production}
DB_HOST: postgres
DB_PORT: 5432
DB_NAME: ${DB_NAME:-medical_fl}
DB_USER: ${DB_USER:-fl_admin}
DB_PASSWORD: ${DB_PASSWORD}
REDIS_HOST: redis
REDIS_PASSWORD: ${REDIS_PASSWORD:-redis_password_123}
volumes:
- ./logs/backend:/app/logs
- ./mlflow:/app/mlflow
- ./uploads:/app/uploads
ports:
- "5000:5000"
depends_on:
postgres:
condition: service_healthy
redis:
condition: service_healthy
networks:
- medical-fl-network
restart: unless-stopped
# Frontend
frontend:
build:
context: .
dockerfile: deploy/docker/frontend.Dockerfile
container_name: medical-fl-frontend
ports:
- "3000:80"
depends_on:
- backend
networks:
- medical-fl-network
restart: unless-stopped
# Flower FL Server
fl-server:
build:
context: .
dockerfile: deploy/docker/fl-server.Dockerfile
container_name: medical-fl-fl-server
environment:
FLOWER_SERVER_HOST: 0.0.0.0
FLOWER_SERVER_PORT: 8080
FL_MIN_CLIENTS: ${FL_MIN_CLIENTS:-3}
FL_ROUNDS: ${FL_ROUNDS:-50}
DP_EPSILON: ${DP_EPSILON:-1.0}
DP_DELTA: ${DP_DELTA:-1e-5}
volumes:
- ./logs/fl-server:/app/logs
- ./models:/app/models
- ./certs:/app/certs
ports:
- "8080:8080"
- "9091:9091"
depends_on:
- backend
networks:
- medical-fl-network
restart: unless-stopped
# MLflow Tracking Server
mlflow:
image: ghcr.io/mlflow/mlflow:latest
container_name: medical-fl-mlflow
environment:
MLFLOW_S3_ENDPOINT_URL: http://minio:9000
AWS_ACCESS_KEY_ID: ${S3_ACCESS_KEY:-minioadmin}
AWS_SECRET_ACCESS_KEY: ${S3_SECRET_KEY:-minioadmin}
command: >
mlflow server
--backend-store-uri postgresql://${DB_USER:-fl_admin}:${DB_PASSWORD}@postgres:54
32/${DB_NAME:-medical_fl}
--default-artifact-root s3://medical-models
--host 0.0.0.0
--port 5000
volumes:
- ./mlflow:/mlflow
ports:
- "5001:5000"
depends_on:
- postgres
- minio
networks:
- medical-fl-network
restart: unless-stopped
# MinIO for model storage
minio:
image: minio/minio:latest
container_name: medical-fl-minio
environment:
MINIO_ROOT_USER: ${S3_ACCESS_KEY:-minioadmin}
MINIO_ROOT_PASSWORD: ${S3_SECRET_KEY:-minioadmin}
command: server /data --console-address ":9001"
volumes:
- minio_data:/data
ports:
- "9000:9000"
- "9001:9001"
networks:
- medical-fl-network
healthcheck:
test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"\]
interval: 30s
timeout: 20s
retries: 3
restart: unless-stopped
# Prometheus for metrics
prometheus:
image: prom/prometheus:latest
container_name: medical-fl-prometheus
volumes:
- ./monitoring/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
- prometheus_data:/prometheus
command:
'
-
--config.file=/etc/prometheus/prometheus.yml'
'
-
--storage.tsdb.path=/prometheus'
'
-
--web.console.libraries=/etc/prometheus/console_libraries'
'
-
--web.console.templates=/etc/prometheus/consoles'
'
-
--storage.tsdb.retention.time=200h'
'
-
--web.enable-lifecycle'
ports:
- "9090:9090"
networks:
- medical-fl-network
restart: unless-stopped
# Grafana for visualization
grafana:
image: grafana/grafana:latest
container_name: medical-fl-grafana
environment:
GF_SECURITY_ADMIN_PASSWORD: ${GRAFANA_PASSWORD:-admin}
GF_INSTALL_PLUGINS: grafana-piechart-panel
volumes:
- grafana_data:/var/lib/grafana
- ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards
- ./monitoring/grafana/datasources:/etc/grafana/provisioning/datasources
ports:
- "3001:3000"
depends_on:
- prometheus
networks:
- medical-fl-network
restart: unless-stopped
# Flower client simulation 1
client-1:
build:
context: .
dockerfile: deploy/docker/client.Dockerfile
container_name: medical-fl-client-1
environment:
CLIENT_ID: hospital-1
SERVER_ADDRESS: fl-server
SERVER_PORT: 8080
DATA_DIR: /app/data
volumes:
- ./data-simulation/brains/hospital-1:/app/data
- ./logs/clients:/app/logs
depends_on:
- fl-server
networks:
- medical-fl-network
restart: unless-stopped
# Flower client simulation 2
client-2:
build:
context: .
dockerfile: deploy/docker/client.Dockerfile
container_name: medical-fl-client-2
environment:
CLIENT_ID: hospital-2
SERVER_ADDRESS: fl-server
SERVER_PORT: 8080
DATA_DIR: /app/data
volumes:
- ./data-simulation/brains/hospital-2:/app/data
- ./logs/clients:/app/logs
depends_on:
- fl-server
networks:
- medical-fl-network
restart: unless-stopped
# Flower client simulation 3
client-3:
build:
context: .
dockerfile: deploy/docker/client.Dockerfile
container_name: medical-fl-client-3
environment:
CLIENT_ID: hospital-3
SERVER_ADDRESS: fl-server
SERVER_PORT: 8080
DATA_DIR: /app/data
volumes:
- ./data-simulation/brains/hospital-3:/app/data
- ./logs/clients:/app/logs
depends_on:
- fl-server
networks:
- medical-fl-network
restart: unless-stopped
networks:
medical-fl-network:
driver: bridge
volumes:
postgres_data:
redis_data:
minio_data:
prometheus_data:
grafana_data:
